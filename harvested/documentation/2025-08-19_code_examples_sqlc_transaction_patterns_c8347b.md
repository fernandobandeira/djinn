---
agent_context: architect
confidence: 0.95
harvested_at: '2025-08-19T15:18:08.211674'
profile: code_examples
source: https://docs.sqlc.dev/en/latest/howto/transactions.html
topic: sqlc Transaction Patterns
---

# sqlc Transaction Patterns

[ ![Logo](https://docs.sqlc.dev/en/latest/_static/logo.png) ](https://docs.sqlc.dev/en/latest/index.html)
latest  stable  v1.29.0  v1.28.0  v1.27.0  v1.26.0  v1.25.0  v1.24.0  v1.23.0  v1.22.0  v1.21.0  v1.20.0  v1.19.1  v1.19.0  v1.18.0  v1.17.2  v1.17.1  v1.17.0  v1.16.0  v1.15.0  v1.14.0  v1.13.0  v1.12.0  v1.11.0  v1.10.0  v1.9.0  v1.8.0  v1.7.0 
Overview
  * [Installing sqlc](https://docs.sqlc.dev/en/latest/overview/install.html)


Tutorials
  * [Getting started with MySQL](https://docs.sqlc.dev/en/latest/tutorials/getting-started-mysql.html)
  * [Getting started with PostgreSQL](https://docs.sqlc.dev/en/latest/tutorials/getting-started-postgresql.html)
  * [Getting started with SQLite](https://docs.sqlc.dev/en/latest/tutorials/getting-started-sqlite.html)


Commands
  * [`generate` - Generating code](https://docs.sqlc.dev/en/latest/howto/generate.html)
  * [`push` - Uploading projects](https://docs.sqlc.dev/en/latest/howto/push.html)
  * [`verify` - Verifying schema changes](https://docs.sqlc.dev/en/latest/howto/verify.html)
  * [`vet` - Linting queries](https://docs.sqlc.dev/en/latest/howto/vet.html)


How-to Guides
  * [Retrieving rows](https://docs.sqlc.dev/en/latest/howto/select.html)
  * [Counting rows](https://docs.sqlc.dev/en/latest/howto/query_count.html)
  * [Inserting rows](https://docs.sqlc.dev/en/latest/howto/insert.html)
  * [Updating rows](https://docs.sqlc.dev/en/latest/howto/update.html)
  * [Deleting rows](https://docs.sqlc.dev/en/latest/howto/delete.html)
  * [Preparing queries](https://docs.sqlc.dev/en/latest/howto/prepared_query.html)
  * [Using transactions](https://docs.sqlc.dev/en/latest/howto/transactions.html)
  * [Naming parameters](https://docs.sqlc.dev/en/latest/howto/named_parameters.html)
  * [Modifying the database schema](https://docs.sqlc.dev/en/latest/howto/ddl.html)
  * [Configuring generated structs](https://docs.sqlc.dev/en/latest/howto/structs.html)
  * [Embedding structs](https://docs.sqlc.dev/en/latest/howto/embedding.html)
  * [Overriding types](https://docs.sqlc.dev/en/latest/howto/overrides.html)
  * [Renaming fields](https://docs.sqlc.dev/en/latest/howto/rename.html)


sqlc Cloud
  * [Managed databases](https://docs.sqlc.dev/en/latest/howto/managed-databases.html)


Reference
  * [Changelog](https://docs.sqlc.dev/en/latest/reference/changelog.html)
  * [CLI](https://docs.sqlc.dev/en/latest/reference/cli.html)
  * [Configuration](https://docs.sqlc.dev/en/latest/reference/config.html)
  * [Datatypes](https://docs.sqlc.dev/en/latest/reference/datatypes.html)
  * [Environment variables](https://docs.sqlc.dev/en/latest/reference/environment-variables.html)
  * [Database and language support](https://docs.sqlc.dev/en/latest/reference/language-support.html)
  * [Macros](https://docs.sqlc.dev/en/latest/reference/macros.html)
  * [Query annotations](https://docs.sqlc.dev/en/latest/reference/query-annotations.html)


Conceptual Guides
  * [Using sqlc in CI/CD](https://docs.sqlc.dev/en/latest/howto/ci-cd.html)
  * [Using Go and pgx](https://docs.sqlc.dev/en/latest/guides/using-go-and-pgx.html)
  * [Using plugins](https://docs.sqlc.dev/en/latest/guides/plugins.html)
  * [Developing sqlc](https://docs.sqlc.dev/en/latest/guides/development.html)
  * [Privacy and data collection](https://docs.sqlc.dev/en/latest/guides/privacy.html)


Sponsored By
[ ![Riza logo](https://sqlc.dev/sponsors/riza-readme.png) ](https://riza.io?utm_source=sqlc+docs)
[sqlc](https://docs.sqlc.dev/en/latest/index.html)
  * [](https://docs.sqlc.dev/en/latest/index.html)
  * Using transactions
  * [ View page source](https://docs.sqlc.dev/en/latest/_sources/howto/transactions.md.txt)


# Using transactions[](https://docs.sqlc.dev/en/latest/howto/transactions.html#using-transactions "Link to this heading")
In the code generated by sqlc, the `WithTx` method allows a `Queries` instance to be associated with a transaction.
For example, with the following SQL structure:
`schema.sql`:
```
CREATETABLErecords(
idSERIALPRIMARYKEY,
counterINTNOTNULL
);

```

`query.sql`
```
-- name: GetRecord :one
SELECT*FROMrecords
WHEREid=$1;
-- name: UpdateRecord :exec
UPDATErecordsSETcounter=$2
WHEREid=$1;

```

And the generated code from sqlc in `db.go`:
```
packagetutorial
import(
"context"
"database/sql"
)
typeDBTXinterface{
ExecContext(context.Context,string,...interface{})(sql.Result,error)
PrepareContext(context.Context,string)(*sql.Stmt,error)
QueryContext(context.Context,string,...interface{})(*sql.Rows,error)
QueryRowContext(context.Context,string,...interface{})*sql.Row
}
funcNew(dbDBTX)*Queries{
return&Queries{db:db}
}
typeQueriesstruct{
dbDBTX
}
func(q*Queries)WithTx(tx*sql.Tx)*Queries{
return&Queries{
db:tx,
}
}

```

You’d use it like this:
```
// Using `github/lib/pq` as the driver.
funcbumpCounter(ctxcontext.Context,db*sql.DB,queries*tutorial.Queries,idint32)error{
tx,err:=db.Begin()
iferr!=nil{
returnerr
}
defertx.Rollback()
qtx:=queries.WithTx(tx)
r,err:=qtx.GetRecord(ctx,id)
iferr!=nil{
returnerr
}
iferr:=qtx.UpdateRecord(ctx,tutorial.UpdateRecordParams{
ID:r.ID,
Counter:r.Counter+1,
});err!=nil{
returnerr
}
returntx.Commit()
}
// Using `github.com/jackc/pgx/v5` as the driver.
funcbumpCounter(ctxcontext.Context,db*pgx.Conn,queries*tutorial.Queries,idint32)error{
tx,err:=db.Begin(ctx)
iferr!=nil{
returnerr
}
defertx.Rollback(ctx)
qtx:=queries.WithTx(tx)
r,err:=qtx.GetRecord(ctx,id)
iferr!=nil{
returnerr
}
iferr:=qtx.UpdateRecord(ctx,tutorial.UpdateRecordParams{
ID:r.ID,
Counter:r.Counter+1,
});err!=nil{
returnerr
}
returntx.Commit(ctx)
}

```

[ Previous](https://docs.sqlc.dev/en/latest/howto/prepared_query.html "Preparing queries") [Next ](https://docs.sqlc.dev/en/latest/howto/named_parameters.html "Naming parameters")
© Copyright 2024, Riza, Inc..
Built with [Sphinx](https://www.sphinx-doc.org/) using a [theme](https://github.com/readthedocs/sphinx_rtd_theme) provided by [Read the Docs](https://readthedocs.org). 


## Source Information
- URL: https://docs.sqlc.dev/en/latest/howto/transactions.html
- Harvested: 2025-08-19T15:18:08.211674
- Profile: code_examples
- Agent: architect
